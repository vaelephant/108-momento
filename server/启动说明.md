# Momento AI Photo Management System å¯åŠ¨è¯´æ˜

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- Python 3.8+
- PostgreSQL 12+
- Redis 6+

### 2. å®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd server

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„é…ç½®ï¼š

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://postgres:ä½ çš„å¯†ç @localhost:5432/momento
REDIS_URL=redis://localhost:6379/0

# å…¶ä»–é…ç½®ï¼ˆå¯é€‰ï¼‰
DEBUG=true
SECRET_KEY=your-secret-key-here
```

### 4. è®¾ç½®æ•°æ®åº“

```bash
# è¿è¡Œæ•°æ®åº“è®¾ç½®è„šæœ¬
python setup_database.py
```

### 5. å¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
python start.py
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# å¯åŠ¨FastAPIæœåŠ¡
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 6. éªŒè¯æœåŠ¡

è®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼š

- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **æ ¹è·¯å¾„**: http://localhost:8000/

## ğŸ”§ è¯¦ç»†é…ç½®

### æ•°æ®åº“é…ç½®

1. **åˆ›å»ºæ•°æ®åº“**ï¼š
```sql
CREATE DATABASE momento;
CREATE USER momento WITH PASSWORD 'momento';
GRANT ALL PRIVILEGES ON DATABASE momento TO momento;
```

2. **éªŒè¯è¿æ¥**ï¼š
```bash
python check_tables.py
```

### Redisé…ç½®

ç¡®ä¿RedisæœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
# æ£€æŸ¥RedisçŠ¶æ€
redis-cli ping
```

### ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `DATABASE_URL` | æ•°æ®åº“è¿æ¥URL | `postgresql://momento:momento@localhost:5432/momento` |
| `REDIS_URL` | Redisè¿æ¥URL | `redis://localhost:6379/0` |
| `DEBUG` | è°ƒè¯•æ¨¡å¼ | `false` |
| `SECRET_KEY` | JWTå¯†é’¥ | `your-secret-key-change-in-production` |
| `UPLOAD_DIR` | æ–‡ä»¶ä¸Šä¼ ç›®å½• | `./uploads` |
| `MODEL_CACHE_DIR` | AIæ¨¡å‹ç¼“å­˜ç›®å½• | `./models` |

## ğŸ³ Dockerå¯åŠ¨ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½¿ç”¨Dockerï¼š

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
   - éªŒè¯æ•°æ®åº“URLé…ç½®
   - ç¡®è®¤ç”¨æˆ·æƒé™

2. **Redisè¿æ¥å¤±è´¥**
   - æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
   - éªŒè¯Redis URLé…ç½®

3. **ç«¯å£è¢«å ç”¨**
   - ä¿®æ”¹ç«¯å£ï¼š`uvicorn app.main:app --port 8001`
   - æˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹

4. **ä¾èµ–åŒ…å®‰è£…å¤±è´¥**
   - æ›´æ–°pipï¼š`pip install --upgrade pip`
   - ä½¿ç”¨å›½å†…é•œåƒï¼š`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple`

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥é…ç½®
python app/config.py

# æ£€æŸ¥æ•°æ®åº“è¡¨
python check_tables.py

# æ£€æŸ¥ChromaDB
python test_chroma.py
```

## ğŸ“Š æœåŠ¡ç›‘æ§

### å¥åº·æ£€æŸ¥ç«¯ç‚¹

- `GET /health` - æœåŠ¡å¥åº·çŠ¶æ€
- `GET /` - æœåŠ¡åŸºæœ¬ä¿¡æ¯

### æ—¥å¿—æ–‡ä»¶

- åº”ç”¨æ—¥å¿—ï¼š`logs/app.log`
- é”™è¯¯æ—¥å¿—ï¼š`logs/error.log`

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. ç¯å¢ƒé…ç½®

```bash
# è®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
export DEBUG=false
export SECRET_KEY=your-production-secret-key
export DATABASE_URL=postgresql://user:pass@prod-db:5432/momento
```

### 2. ä½¿ç”¨Gunicorn

```bash
# å®‰è£…Gunicorn
pip install gunicorn

# å¯åŠ¨ç”Ÿäº§æœåŠ¡
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

### 3. ä½¿ç”¨Nginxåå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ“ APIä½¿ç”¨ç¤ºä¾‹

### ä¸Šä¼ ç…§ç‰‡

```bash
curl -X POST "http://localhost:8000/api/v1/upload" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@your-photo.jpg"
```

### è·å–ç…§ç‰‡åˆ—è¡¨

```bash
curl "http://localhost:8000/api/v1/photos?page=1&page_size=20"
```

### æœç´¢ç…§ç‰‡

```bash
curl "http://localhost:8000/api/v1/search/photos?query=cat&tags=animal"
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **å¯åŠ¨Celery Worker**ï¼ˆç”¨äºAIå¤„ç†ï¼‰ï¼š
```bash
celery -A app.celery_app worker --loglevel=info
```

2. **é…ç½®å‰ç«¯è¿æ¥**ï¼š
   - ä¿®æ”¹å‰ç«¯APIåœ°å€ä¸º `http://localhost:8000`
   - ç¡®ä¿CORSé…ç½®æ­£ç¡®

3. **å¼€å§‹ä½¿ç”¨**ï¼š
   - è®¿é—® http://localhost:8000/docs æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£
   - ä¸Šä¼ ç…§ç‰‡æµ‹è¯•AIæ ‡ç­¾ç”Ÿæˆ
   - ä½¿ç”¨æœç´¢åŠŸèƒ½æµ‹è¯•å‘é‡æ£€ç´¢

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ‰€æœ‰ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
2. æ•°æ®åº“å’ŒRedisæœåŠ¡æ˜¯å¦è¿è¡Œ
3. ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®
4. ç«¯å£æ˜¯å¦è¢«å ç”¨

---

ğŸ‰ **æ­å–œï¼ä½ çš„Momento AI Photo Management Systemå·²ç»å‡†å¤‡å°±ç»ªï¼**
