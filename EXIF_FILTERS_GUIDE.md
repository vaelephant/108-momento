# 📍 EXIF筛选功能使用指南

## ✨ 功能概述

侧边栏新增了基于EXIF信息的智能筛选功能，可以快速按照以下维度查找照片：
- 📅 **拍摄时间** - 按年月分组
- 📍 **拍摄地点** - 基于GPS位置
- 📷 **相机型号** - 按设备分类

## 🎯 使用方法

### 1. 按时间筛选

侧边栏显示最近12个月的拍摄时间，格式为"年月"：

```
📅 时间轴
├─ 2024年10月 (15)
├─ 2024年9月 (23)
├─ 2024年8月 (18)
└─ ...
```

**点击任意月份**，即可筛选出该月拍摄的所有照片。

**示例：**
- 点击 "2024年10月" → 显示所有2024年10月拍摄的照片
- 右侧数字表示该月的照片数量

### 2. 按地点筛选

显示所有有GPS信息的拍摄地点：

```
📍 拍摄地点
├─ 31.2, 121.5 (8)
├─ 39.9, 116.4 (5)
├─ 22.5, 114.1 (3)
└─ ...
```

**点击任意地点**，即可查看在该位置拍摄的照片。

**注意：**
- 坐标经过简化显示（保留1位小数）
- 相近的GPS坐标会自动归类
- 只显示前10个最常见的拍摄地点

### 3. 按相机筛选

显示所有相机型号：

```
📷 相机型号
[Canon EOS 5D (12)] [iPhone 14 Pro (8)] [Sony A7III (5)]
```

**点击任意相机型号**，即可查看该设备拍摄的所有照片。

**示例：**
- 点击 "Canon EOS 5D" → 显示所有用该相机拍摄的照片
- 方便对比不同设备的拍摄效果

## 🔍 筛选逻辑

### 数据来源

筛选器从照片的EXIF数据中提取信息：

```typescript
// 照片EXIF数据结构
photo.exif_data = {
  dateTaken: "2024-10-20T15:30:00",  // 拍摄时间
  location: "31.23, 121.47",         // GPS位置
  camera: "Canon EOS 5D",            // 相机型号
  latitude: 31.23,                   // 纬度
  longitude: 121.47                  // 经度
}
```

### 筛选优先级

1. **时间优先使用拍摄时间**
   - 如果有EXIF的`dateTaken` → 使用拍摄时间
   - 否则使用`uploadedAt` → 使用上传时间

2. **地点显示简化**
   - GPS坐标简化为1位小数
   - 便于快速识别和归类

3. **相机型号完整显示**
   - 包含品牌和型号
   - 例如："Canon EOS 5D Mark IV"

### 搜索匹配

点击筛选项后，会触发全局搜索，匹配规则：

```typescript
// 匹配以下任一项即可显示
- 照片标题
- 照片描述
- AI标签
- 相机型号
- GPS位置
- 拍摄年月（YYYY-MM格式）
```

## 📊 侧边栏布局

完整的侧边栏结构：

```
┌─────────────────────────┐
│ 视图                    │
│ ├─ 时间轴              │
│ └─ 分类                │
├─────────────────────────┤
│ 📅 时间轴 (NEW!)       │
│ ├─ 2024年10月 (15)     │
│ ├─ 2024年9月 (23)      │
│ └─ ...                 │
├─────────────────────────┤
│ 📍 拍摄地点 (NEW!)     │
│ ├─ 31.2, 121.5 (8)    │
│ ├─ 39.9, 116.4 (5)    │
│ └─ ...                 │
├─────────────────────────┤
│ 📷 相机型号 (NEW!)     │
│ [Canon EOS 5D (12)]    │
│ [iPhone 14 Pro (8)]    │
│ [Sony A7III (5)]       │
├─────────────────────────┤
│ 分类                    │
│ ├─ 自然                │
│ ├─ 城市                │
│ └─ ...                 │
├─────────────────────────┤
│ 热门标签                │
│ [山] [海] [天空] ...   │
└─────────────────────────┘
```

## 💡 使用场景

### 场景1：查找旅行照片
1. 点击侧边栏 "📍 拍摄地点"
2. 选择旅行目的地的GPS坐标
3. 查看该地点的所有照片

### 场景2：回顾某月记忆
1. 点击侧边栏 "📅 时间轴"
2. 选择想要回顾的月份
3. 浏览该月的所有照片

### 场景3：对比相机效果
1. 点击侧边栏 "📷 相机型号"
2. 选择某个相机
3. 查看该相机的拍摄效果

### 场景4：组合筛选
```
1. 先点击 "Canon EOS 5D"
2. 在搜索框输入 "山"
3. 结果：用Canon相机拍摄的山景照片
```

## 🎨 UI特性

### 交互反馈
- **悬停高亮** - 鼠标悬停时背景变亮
- **数量徽章** - 显示每个筛选项的照片数
- **截断文字** - 长文本自动截断并显示省略号
- **工具提示** - 悬停显示完整内容

### 响应式设计
- **大屏幕** - 侧边栏固定在右侧
- **平板** - 侧边栏收起为抽屉
- **手机** - 通过菜单按钮展开

### 视觉层次
```
时间轴  ← 最常用，放在最上方
  ↓
地点    ← 次常用，紧随其后
  ↓
相机    ← 专业功能，靠后放置
  ↓
分类    ← 传统分类
  ↓
标签云  ← AI标签
```

## 🔧 技术实现

### 组件结构

```tsx
<ExifFilters 
  photos={allPhotos}                    // 所有照片列表
  onFilterChange={handleExifFilter}     // 筛选回调
/>
```

### 数据处理

```typescript
// 1. 提取拍摄时间
photos.forEach(photo => {
  if (photo.exif_data?.dateTaken) {
    const date = new Date(photo.exif_data.dateTaken)
    const yearMonth = `${date.getFullYear()}-${date.getMonth() + 1}`
    // 按年月分组
  }
})

// 2. 提取地理位置
photos.forEach(photo => {
  if (photo.exif_data?.location) {
    const simplified = simplifyLocation(photo.exif_data.location)
    // 简化GPS坐标
  }
})

// 3. 提取相机型号
photos.forEach(photo => {
  if (photo.exif_data?.camera) {
    // 统计相机使用次数
  }
})
```

### 性能优化

```typescript
// 使用useMemo缓存计算结果
const timeGroups = useMemo(() => {
  // 只在photos改变时重新计算
}, [photos])

// 限制显示数量
.slice(0, 12)  // 最近12个月
.slice(0, 10)  // 最多10个地点
.slice(0, 8)   // 最多8个相机
```

## 📈 数据统计

筛选器会自动统计：

| 维度 | 显示数量 | 排序规则 |
|------|---------|---------|
| 时间 | 最近12个月 | 时间倒序 |
| 地点 | 最多10个 | 照片数倒序 |
| 相机 | 最多8个 | 使用次数倒序 |

## ⚠️ 注意事项

### 1. EXIF数据可用性
- 只显示有EXIF信息的照片
- 截图、编辑过的照片可能没有EXIF
- 某些应用会移除EXIF信息

### 2. GPS隐私
- GPS位置是敏感信息
- 建议添加隐私开关
- 分享时可选择隐藏位置

### 3. 坐标精度
- 显示时简化为1位小数
- 实际存储保留完整精度
- 查询时使用精确值

### 4. 时间处理
- 优先使用拍摄时间
- 回退到上传时间
- 时区统一处理

## 🚀 未来增强

### 1. 地图视图
```tsx
// 在地图上显示拍摄位置
<MapView 
  photos={photosWithGPS}
  onLocationClick={showPhotosAtLocation}
/>
```

### 2. 时间轴可视化
```tsx
// 时间轴图表显示拍摄频率
<TimelineChart 
  data={photosByMonth}
  onRangeSelect={filterByDateRange}
/>
```

### 3. 高级筛选
```tsx
// 组合多个条件
<AdvancedFilter>
  <DateRangeFilter />
  <LocationRadiusFilter />
  <CameraModelFilter />
  <TagFilter />
</AdvancedFilter>
```

### 4. 地理反编码
```typescript
// 将GPS坐标转换为地址
const address = await geocode(31.23, 121.47)
// "中国上海市浦东新区陆家嘴"
```

## 📝 更新日志

### v1.0.0 (2024-10-22)
- ✅ 新增时间轴筛选
- ✅ 新增地理位置筛选
- ✅ 新增相机型号筛选
- ✅ 支持点击快速筛选
- ✅ 显示照片数量统计
- ✅ 响应式布局适配

---

更新时间: 2024-10-22
作者: Momento Team
版本: 1.0.0

